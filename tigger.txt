- task: AzureCLI@2
  inputs:
    azureSubscription: 'Pay-As-You-Go (3ddadea6-786b-4549-8952-22502c6566db)'  # Your Azure subscription
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Exit on error and enable debug output
      set -eux

      # Update package list
      echo "Updating apt-get..."
      sudo apt-get update -y

      # Install Nix
      echo "Installing Nix..."
      curl -L https://nixos.org/nix/install | sh -s -- --daemon
      
      # Ensure the Nix environment is loaded for the current session
      echo "Loading Nix environment..."
      . $HOME/.nix-profile/etc/profile.d/nix.sh
      export PATH=$HOME/.nix-profile/bin:$PATH

      # Verify Nix installation
      echo "Verifying Nix installation..."
      nix --version

      # Install Node.js using Nix
      echo "Installing Node.js via Nix..."
      nix-env -iA nixpkgs.nodejs

      # Confirm Node.js installation
      echo "Confirming Node.js installation..."
      node --version

      # Install Node.js using apt-get (additional, optional method)
      echo "Installing Node.js using apt-get..."
      sudo apt-get install -y nodejs
      node --version

      # Install yamllint using apt-get
      echo "Installing yamllint using apt-get..."
      sudo apt-get install -y yamllint

      # Install yamllint via pip (additional method)
      echo "Installing yamllint via pip..."
      sudo apt-get install -y python3-pip
      pip3 install yamllint

      # Confirm yamllint installation
      echo "Confirming yamllint installation..."
      yamllint --version

  displayName: 'Install Nix, Node.js, and yamllint'
